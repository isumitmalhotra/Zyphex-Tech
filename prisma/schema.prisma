// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Define your models here
model User {
  id           String    @id @default(uuid())
  email        String    @unique
  name         String?
  password     String?
  role         Role      @default(USER)
  skills       Json? // Array of user skills
  hourlyRate   Float? // Default hourly rate
  availability Json? // Availability schedule
  timezone     String? // User timezone
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime? // Soft delete capability

  // Existing relations
  projects        Project[]
  managedProjects Project[] @relation("ProjectManager")
  teams           Team[]
  accounts        Account[]
  sessions        Session[]
  emailVerified   DateTime?
  image           String?

  // New relations for IT Services Platform
  timeEntries      TimeEntry[]
  assignedTasks    Task[]           @relation("TaskAssignee")
  createdTasks     Task[]           @relation("TaskCreator")
  activityLogs     ActivityLog[]
  sentMessages     Message[]        @relation("MessageSender")
  receivedMessages Message[]        @relation("MessageReceiver")
  documents        Document[]
  teamMemberships  TeamMember[]
  contactLogs      ContactLog[]
  resourceProfile  ResourceProfile?
  userPermissions  UserPermission[]
  auditLogs        AuditLog[]
  refreshTokens    RefreshToken[]

  // New messaging relations
  createdChannels  Channel[]         @relation("ChannelCreator")
  channels         Channel[]         @relation("ChannelMembers")
  messageReads     MessageRead[]     @relation("UserMessageReads")
  messageReactions MessageReaction[] @relation("UserMessageReactions")
  notifications    Notification[]    @relation("UserNotifications")

  // Advanced Project Management Relations
  ownedRisks          ProjectRisk[]          @relation("RiskOwner")
  identifiedRisks     ProjectRisk[]          @relation("RiskIdentifier")
  changeRequests      ChangeRequest[]        @relation("ChangeRequester")
  approvedChanges     ChangeRequest[]        @relation("ChangeApprover")
  resourceAllocations ResourceAllocation[]   @relation("ResourceAllocations")
  sentCommunications  ProjectCommunication[] @relation("CommunicationSender")
  uploadedDocuments   ProjectDocument[]      @relation("DocumentUploader")
  expenses            Expense[]
  LeadActivity        LeadActivity[]

  // Meeting relations
  organizedMeetings   Meeting[]           @relation("MeetingOrganizer")
  meetingAttendances  MeetingAttendee[]   @relation("MeetingAttendees")
  assignedActionItems MeetingActionItem[] @relation("ActionItemAssignee")

  // File upload security (Phase 1)
  files File[]

  // Token management security (Phase 2)
  tokenBlacklist TokenBlacklist[]

  // Workflow automation (Task 8)
  createdWorkflows Workflow[] @relation("WorkflowCreator")

  // CMS Relations (Tasks #21 & #22)
  cmsComments CmsComment[] // Task #22: Comment system

  // Optimized Indexes for Performance
  @@index([email]) // Existing - Login queries
  @@index([role]) // Existing - Authorization queries
  @@index([deletedAt]) // Existing - Soft delete queries
  @@index([createdAt]) // Sorting/pagination
  @@index([updatedAt]) // Recently modified users
  @@index([emailVerified]) // Verified user queries
  @@index([role, deletedAt]) // Compound: Active users by role
  @@index([role, createdAt]) // Compound: Recent users by role
  @@index([email, deletedAt]) // Compound: Active user login
}

model Permission {
  id          String   @id @default(uuid())
  name        String   @unique // e.g., 'create_project', 'view_financials'
  description String?
  category    String? // e.g., 'projects', 'users', 'financials'
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@index([name])
  @@index([category])
}

model RolePermission {
  id           String   @id @default(uuid())
  role         Role
  permissionId String
  createdAt    DateTime @default(now())

  // Relations
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([role, permissionId])
  @@index([role])
}

model UserPermission {
  id           String    @id @default(uuid())
  userId       String
  permissionId String
  grantedBy    String? // User ID who granted this permission
  expiresAt    DateTime? // Optional expiration
  createdAt    DateTime  @default(now())

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@index([userId])
  @@index([expiresAt])
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Phase 2 enhancements
  deviceInfo String    @default("Unknown Device") // Device/browser identification
  lastUsedAt DateTime? // Track when token was last used for rotation

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([token])
  @@index([lastUsedAt])
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String? // Null for system actions
  action     String // e.g., 'LOGIN', 'CREATE_PROJECT', 'PERMISSION_GRANTED'
  resource   String? // e.g., 'USER', 'PROJECT', 'CLIENT'
  resourceId String? // ID of the affected resource
  details    String? // JSON string with additional details
  ipAddress  String?
  userAgent  String?
  success    Boolean  @default(true)
  createdAt  DateTime @default(now())

  // Relations
  user User? @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
}

model Client {
  id        String    @id @default(uuid())
  name      String
  email     String    @unique
  phone     String?
  address   String?
  company   String?
  website   String?
  timezone  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete capability

  // Relations
  projects           Project[]
  invoices           Invoice[]
  contactLogs        ContactLog[]
  billingContracts   BillingContract[]
  paymentConfigs     PaymentConfig[]
  Deal               Deal[]
  meetings           Meeting[]
  meetingAttendances MeetingAttendee[]

  // Optimized Indexes for Performance
  @@index([email]) // Existing - Email lookup
  @@index([name]) // Existing - Name search
  @@index([deletedAt]) // Existing - Soft delete queries
  @@index([createdAt]) // Time-based sorting
  @@index([company]) // Company name search
  @@index([phone]) // Phone lookup
  @@index([name, deletedAt]) // Compound: Active clients by name
  @@index([email, deletedAt]) // Compound: Active client lookup
}

model Project {
  id              String             @id @default(uuid())
  name            String
  description     String?
  status          ProjectStatus      @default(PLANNING)
  priority        Priority           @default(MEDIUM)
  methodology     ProjectMethodology @default(AGILE)
  templateId      String? // Reference to template used
  budget          Float
  budgetUsed      Float              @default(0)
  hourlyRate      Float
  startDate       DateTime?
  endDate         DateTime?
  estimatedHours  Int?
  actualHours     Int?
  completionRate  Int                @default(0) // Percentage
  isClientVisible Boolean            @default(true)
  riskTolerance   String? // Low, Medium, High
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  deletedAt       DateTime? // Soft delete capability

  // Relations
  clientId    String
  managerId   String? // Project manager ID
  client      Client           @relation(fields: [clientId], references: [id])
  manager     User?            @relation("ProjectManager", fields: [managerId], references: [id])
  template    ProjectTemplate? @relation("ProjectFromTemplate", fields: [templateId], references: [id])
  users       User[]
  teams       Team[]
  tasks       Task[]
  timeEntries TimeEntry[]
  invoices    Invoice[]
  messages    Message[]
  documents   Document[]
  teamMembers TeamMember[]

  // Advanced Project Management Relations
  risks               ProjectRisk[]
  milestones          ProjectMilestone[]
  changeRequests      ChangeRequest[]
  resourceAllocations ResourceAllocation[]
  communications      ProjectCommunication[]
  projectDocuments    ProjectDocument[]
  budgetItems         ProjectBudgetItem[]
  expenses            Expense[]
  billingContracts    BillingContract[]
  paymentConfigs      PaymentConfig[]

  // New messaging relations
  channels Channel[]

  // Notifications
  notifications Notification[]

  // Meeting relations
  meetings Meeting[]

  // File upload security
  files File[]

  // Optimized Indexes for Performance
  @@index([clientId]) // Existing - Client's projects
  @@index([managerId]) // Existing - Manager's projects
  @@index([status]) // Existing - Filter by status
  @@index([priority]) // Existing - Filter by priority
  @@index([methodology]) // Existing - Filter by methodology
  @@index([templateId]) // Existing - Template tracking
  @@index([startDate, endDate]) // Existing - Date range queries
  @@index([deletedAt]) // Existing - Soft delete queries
  @@index([createdAt]) // Sorting/pagination
  @@index([updatedAt]) // Recently updated projects
  @@index([completionRate]) // Progress tracking
  @@index([isClientVisible]) // Client portal queries
  @@index([clientId, status]) // Compound: Client projects by status
  @@index([managerId, status]) // Compound: Manager projects by status
  @@index([clientId, status, deletedAt]) // Compound: Active client projects
  @@index([status, priority, createdAt]) // Compound: Complex filtering
  @@index([status, updatedAt]) // Compound: Recently active projects
  @@index([managerId, priority, status]) // Compound: Manager priority view
}

model Team {
  id          String       @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  deletedAt   DateTime? // Soft delete capability
  users       User[]
  projects    Project[]
  teamMembers TeamMember[]

  // Optimized Indexes for Performance
  @@index([name]) // Existing - Name search
  @@index([deletedAt]) // Existing - Soft delete queries
  @@index([createdAt]) // Time-based sorting
  @@index([name, deletedAt]) // Compound: Active teams
}

// IT Services Platform Models
model TimeEntry {
  id          String          @id @default(uuid())
  userId      String
  taskId      String?
  projectId   String?
  invoiceId   String? // Reference to invoice when billed
  hours       Float
  duration    Float? // Duration in hours (for compatibility)
  billable    Boolean         @default(true)
  date        DateTime
  description String?
  rate        Float
  amount      Float
  status      TimeEntryStatus @default(DRAFT)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  // Relations
  user    User     @relation(fields: [userId], references: [id])
  task    Task?    @relation(fields: [taskId], references: [id])
  project Project? @relation(fields: [projectId], references: [id])
  invoice Invoice? @relation(fields: [invoiceId], references: [id])

  // Optimized Indexes for Performance
  @@index([userId]) // Existing - User's time entries
  @@index([taskId]) // Existing - Task time entries
  @@index([projectId]) // Existing - Project time entries
  @@index([date]) // Existing - Date-based queries
  @@index([billable]) // Existing - Billable time filtering
  @@index([status]) // Status filtering
  @@index([invoiceId]) // Invoice linkage
  @@index([createdAt]) // Sorting/pagination
  @@index([userId, date]) // Compound: User timesheet queries
  @@index([projectId, date]) // Compound: Project time tracking
  @@index([userId, status]) // Compound: User entries by status
  @@index([billable, status, date]) // Compound: Billing queries
  @@index([projectId, billable, status]) // Compound: Project billable time
  @@index([userId, projectId, date]) // Compound: User project tracking
}

model Invoice {
  id                  String        @id @default(uuid())
  clientId            String
  projectId           String?
  invoiceNumber       String        @unique
  amount              Float
  taxAmount           Float         @default(0)
  discountAmount      Float         @default(0)
  total               Float
  currency            String        @default("USD")
  status              InvoiceStatus @default(DRAFT)
  billingType         BillingType   @default(HOURLY)
  dueDate             DateTime
  sentAt              DateTime?
  paidAt              DateTime?
  overdueAt           DateTime? // When invoice became overdue
  lastReminderAt      DateTime? // Last payment reminder sent
  lineItems           Json // Array of invoice line items
  notes               String?
  terms               String?
  paymentInstructions String? // Custom payment instructions
  metadata            Json? // Additional invoice data
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  // Relations
  client           Client            @relation(fields: [clientId], references: [id])
  project          Project?          @relation(fields: [projectId], references: [id])
  payments         Payment[]
  timeEntries      TimeEntry[]
  expenses         Expense[]
  paymentReminders PaymentReminder[]
  lateFees         LateFee[]

  // Optimized Indexes for Performance
  @@index([clientId]) // Existing - Client invoices
  @@index([projectId]) // Existing - Project invoices
  @@index([status]) // Existing - Invoice status filtering
  @@index([dueDate]) // Existing - Due date sorting/filtering
  @@index([invoiceNumber]) // Existing - Invoice lookup
  @@index([overdueAt]) // Existing - Overdue tracking
  @@index([createdAt]) // Sorting/pagination
  @@index([sentAt]) // Sent invoice tracking
  @@index([paidAt]) // Payment tracking
  @@index([billingType]) // Billing type filtering
  @@index([clientId, status]) // Compound: Client invoices by status
  @@index([status, dueDate]) // Compound: Overdue invoice queries
  @@index([clientId, status, dueDate]) // Compound: Client invoice dashboard
  @@index([projectId, status]) // Compound: Project invoices by status
  @@index([status, createdAt]) // Compound: Recent invoices by status
  @@index([clientId, dueDate]) // Compound: Client payment schedule
}

model Payment {
  id               String        @id @default(uuid())
  invoiceId        String
  amount           Float
  currency         String        @default("USD")
  paymentMethod    PaymentMethod
  paymentReference String? // Stripe/PayPal transaction ID
  status           PaymentStatus @default(PENDING)
  processedAt      DateTime?
  failureReason    String? // Payment failure details
  refundAmount     Float? // Partial refund tracking
  refundReason     String? // Refund justification
  stripePaymentId  String? // Stripe Payment Intent ID
  paypalOrderId    String? // PayPal Order ID
  gatewayFees      Float? // Transaction fees charged by gateway
  metadata         Json? // Additional payment gateway data
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  // Relations
  invoice          Invoice           @relation(fields: [invoiceId], references: [id])
  paymentReminders PaymentReminder[]

  // Optimized Indexes for Performance
  @@index([invoiceId]) // Existing - Invoice payments
  @@index([status]) // Existing - Payment status filtering
  @@index([paymentMethod]) // Existing - Payment method tracking
  @@index([stripePaymentId]) // Existing - Stripe lookup
  @@index([paypalOrderId]) // Existing - PayPal lookup
  @@index([createdAt]) // Sorting/pagination
  @@index([processedAt]) // Processing time tracking
  @@index([invoiceId, status]) // Compound: Invoice payment status
  @@index([status, processedAt]) // Compound: Payment processing queries
  @@index([paymentMethod, status]) // Compound: Method-based filtering
}

model PaymentReminder {
  id           String              @id @default(uuid())
  invoiceId    String
  paymentId    String? // Optional: linked to specific payment attempt
  type         PaymentReminderType
  sentAt       DateTime
  dueDate      DateTime
  amount       Float
  lateFee      Float               @default(0)
  reminderText String
  emailSent    Boolean             @default(false)
  smsGent      Boolean             @default(false)
  responded    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  // Relations
  invoice Invoice  @relation(fields: [invoiceId], references: [id])
  payment Payment? @relation(fields: [paymentId], references: [id])

  @@index([invoiceId])
  @@index([type])
  @@index([sentAt])
  @@index([dueDate])
}

model LateFee {
  id         String    @id @default(uuid())
  invoiceId  String
  amount     Float
  percentage Float? // Late fee as percentage of invoice
  flatFee    Float? // Fixed late fee amount
  appliedAt  DateTime
  reason     String
  waived     Boolean   @default(false)
  waivedAt   DateTime?
  waivedBy   String? // User ID who waived the fee
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // Relations
  invoice Invoice @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([appliedAt])
  @@index([waived])
}

model PaymentConfig {
  id                   String   @id @default(uuid())
  clientId             String? // Client-specific config
  projectId            String? // Project-specific config
  stripeEnabled        Boolean  @default(false)
  paypalEnabled        Boolean  @default(false)
  bankTransferEnabled  Boolean  @default(true)
  checkEnabled         Boolean  @default(true)
  stripePublishableKey String?
  stripeSecretKey      String? // Encrypted
  paypalClientId       String?
  paypalClientSecret   String? // Encrypted
  defaultCurrency      String   @default("USD")
  lateFeeEnabled       Boolean  @default(false)
  lateFeePercentage    Float? // Late fee as percentage
  lateFeeFlatAmount    Float? // Fixed late fee amount
  lateFeeGraceDays     Int      @default(0)
  reminderEnabled      Boolean  @default(true)
  reminderDaysBefore   Int      @default(3)
  reminderDaysAfter    Int      @default(7)
  bankAccountName      String?
  bankAccountNumber    String?
  bankRoutingNumber    String?
  bankSwiftCode        String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  client  Client?  @relation(fields: [clientId], references: [id])
  project Project? @relation(fields: [projectId], references: [id])

  @@index([clientId])
  @@index([projectId])
}

model Expense {
  id          String          @id @default(uuid())
  projectId   String?
  userId      String
  invoiceId   String? // Reference to invoice when billed
  category    ExpenseCategory
  amount      Float
  currency    String          @default("USD")
  description String
  receiptUrl  String?
  date        DateTime
  reimbursed  Boolean         @default(false)
  billable    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  // Relations
  project Project? @relation(fields: [projectId], references: [id])
  user    User     @relation(fields: [userId], references: [id])
  invoice Invoice? @relation(fields: [invoiceId], references: [id])

  // Optimized Indexes for Performance
  @@index([projectId]) // Existing - Project expenses
  @@index([userId]) // Existing - User expenses
  @@index([category]) // Existing - Category filtering
  @@index([date]) // Existing - Date-based queries
  @@index([invoiceId]) // Invoice linkage
  @@index([reimbursed]) // Reimbursement tracking
  @@index([billable]) // Billable expense filtering
  @@index([createdAt]) // Time-based sorting
  @@index([projectId, billable]) // Compound: Project billable expenses
  @@index([userId, date]) // Compound: User expense timeline
  @@index([reimbursed, userId]) // Compound: User reimbursement status
}

model BillingContract {
  id             String       @id @default(uuid())
  clientId       String
  projectId      String?
  contractType   BillingType
  hourlyRate     Float?
  fixedAmount    Float?
  retainerAmount Float?
  billingCycle   BillingCycle @default(MONTHLY)
  startDate      DateTime
  endDate        DateTime?
  isActive       Boolean      @default(true)
  autoInvoice    Boolean      @default(true)
  metadata       Json? // Additional contract terms
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  client  Client   @relation(fields: [clientId], references: [id])
  project Project? @relation(fields: [projectId], references: [id])

  // Optimized Indexes for Performance
  @@index([clientId]) // Existing - Client contracts
  @@index([projectId]) // Existing - Project contracts
  @@index([contractType]) // Existing - Contract type filtering
  @@index([isActive]) // Existing - Active contract filtering
  @@index([startDate]) // Start date tracking
  @@index([endDate]) // End date tracking
  @@index([billingCycle]) // Billing cycle filtering
  @@index([clientId, isActive]) // Compound: Active client contracts
  @@index([isActive, billingCycle]) // Compound: Active billing cycles
}

model Task {
  id             String     @id @default(uuid())
  projectId      String
  assigneeId     String?
  createdBy      String
  title          String
  description    String?
  status         TaskStatus @default(TODO)
  priority       Priority   @default(MEDIUM)
  dueDate        DateTime?
  startDate      DateTime?
  completedAt    DateTime?
  estimatedHours Int?
  actualHours    Int?
  progress       Int        @default(0) // Percentage 0-100
  tags           String? // JSON array of tags
  order          Int        @default(0)
  isBlocking     Boolean    @default(false) // Critical path task
  isMilestone    Boolean    @default(false)
  skillsRequired Json? // Array of required skills
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  deletedAt      DateTime? // Soft delete capability

  // Relations
  project     Project     @relation(fields: [projectId], references: [id])
  assignee    User?       @relation("TaskAssignee", fields: [assigneeId], references: [id])
  creator     User        @relation("TaskCreator", fields: [createdBy], references: [id])
  timeEntries TimeEntry[]

  // Task Dependency Relations
  dependencies TaskDependency[] @relation("TaskDependencies")
  dependents   TaskDependency[] @relation("TaskDependents")

  // Optimized Indexes for Performance
  @@index([projectId]) // Existing - Project tasks
  @@index([assigneeId]) // Existing - Assignee tasks
  @@index([createdBy]) // Existing - Creator tracking
  @@index([status]) // Existing - Status filtering
  @@index([priority]) // Existing - Priority filtering
  @@index([dueDate]) // Existing - Due date sorting
  @@index([isBlocking]) // Existing - Critical path
  @@index([createdAt]) // Sorting/pagination
  @@index([updatedAt]) // Recently updated tasks
  @@index([completedAt]) // Completion tracking
  @@index([startDate]) // Start date tracking
  @@index([isMilestone]) // Milestone filtering
  @@index([projectId, status]) // Compound: Project tasks by status
  @@index([assigneeId, status]) // Compound: User tasks by status
  @@index([projectId, assigneeId]) // Compound: User tasks in project
  @@index([status, priority, dueDate]) // Compound: Complex task queries
  @@index([assigneeId, dueDate, status]) // Compound: User upcoming tasks
  @@index([projectId, priority, status]) // Compound: Project priority view
  @@index([status, dueDate]) // Compound: Overdue task queries
  @@index([assigneeId, priority]) // Compound: User priority tasks
  @@index([deletedAt]) // Soft delete queries
  @@index([id, deletedAt]) // Compound: Task lookup with soft delete
  @@index([status, deletedAt]) // Compound: Active tasks by status
  @@index([priority, deletedAt]) // Compound: Active tasks by priority
  @@index([projectId, deletedAt]) // Compound: Active project tasks
  @@index([assigneeId, deletedAt]) // Compound: Active assignee tasks
  @@index([projectId, status, deletedAt]) // Compound: Active project tasks by status
  @@index([assigneeId, status, deletedAt]) // Compound: Active assignee tasks by status
  @@index([assigneeId, dueDate, deletedAt]) // Compound: Active user upcoming tasks
}

model ActivityLog {
  id         String   @id @default(uuid())
  userId     String
  action     String // e.g., 'CREATE', 'UPDATE', 'DELETE'
  entityType String // e.g., 'PROJECT', 'TASK', 'CLIENT'
  entityId   String
  changes    String? // JSON object of changes
  ipAddress  String?
  userAgent  String?
  metadata   String? // JSON object for additional context
  createdAt  DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id])

  // Optimized Indexes for Performance
  @@index([userId]) // Existing - User activities
  @@index([entityType, entityId]) // Existing - Entity tracking
  @@index([createdAt]) // Existing - Time-based queries
  @@index([action]) // Existing - Action filtering
  @@index([userId, createdAt]) // Compound: User activity timeline
  @@index([entityType, createdAt]) // Compound: Entity activity history
  @@index([action, createdAt]) // Compound: Action timeline
  @@index([userId, action]) // Compound: User action filtering
  @@index([userId, entityType]) // Compound: User entity activities
}

model Message {
  id          String      @id @default(uuid())
  senderId    String
  receiverId  String? // Null for broadcast messages or channel messages
  channelId   String? // New: for channel-based messages
  projectId   String?
  subject     String?
  content     String
  messageType MessageType @default(DIRECT)
  priority    Priority    @default(MEDIUM)
  readAt      DateTime?
  parentId    String? // For threaded messages
  attachments String? // JSON array of attachment URLs
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  sender    User              @relation("MessageSender", fields: [senderId], references: [id])
  receiver  User?             @relation("MessageReceiver", fields: [receiverId], references: [id])
  channel   Channel?          @relation(fields: [channelId], references: [id])
  project   Project?          @relation(fields: [projectId], references: [id])
  parent    Message?          @relation("MessageThread", fields: [parentId], references: [id])
  replies   Message[]         @relation("MessageThread")
  reads     MessageRead[]
  reactions MessageReaction[]

  // Optimized Indexes for Performance
  @@index([senderId]) // Existing - Sender messages
  @@index([receiverId]) // Existing - Receiver messages
  @@index([channelId]) // Existing - Channel messages
  @@index([projectId]) // Existing - Project messages
  @@index([createdAt]) // Existing - Time-based sorting
  @@index([readAt]) // Existing - Read status tracking
  @@index([parentId]) // Thread parent tracking
  @@index([messageType]) // Message type filtering
  @@index([priority]) // Priority filtering
  @@index([senderId, createdAt]) // Compound: Sender message history
  @@index([receiverId, readAt]) // Compound: Unread messages
  @@index([channelId, createdAt]) // Compound: Channel message timeline
  @@index([projectId, createdAt]) // Compound: Project message timeline
  @@index([receiverId, readAt, createdAt]) // Compound: Recent unread messages
}

model Channel {
  id          String      @id @default(uuid())
  name        String
  description String?
  type        ChannelType @default(TEAM)
  isPrivate   Boolean     @default(false)
  isPinned    Boolean     @default(false)
  projectId   String?
  createdById String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  project   Project?  @relation(fields: [projectId], references: [id])
  createdBy User      @relation("ChannelCreator", fields: [createdById], references: [id])
  members   User[]    @relation("ChannelMembers")
  messages  Message[]

  @@unique([name, projectId]) // Channel names must be unique within a project
  // Optimized Indexes for Performance
  @@index([projectId]) // Existing - Project channels
  @@index([type]) // Existing - Channel type filtering
  @@index([createdAt]) // Existing - Time-based sorting
  @@index([createdById]) // Creator tracking
  @@index([isPrivate]) // Privacy filtering
  @@index([isPinned]) // Pinned channels
  @@index([projectId, type]) // Compound: Project channels by type
  @@index([type, isPrivate]) // Compound: Channel access filtering
}

model MessageRead {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  readAt    DateTime @default(now())

  // Relations
  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation("UserMessageReads", fields: [userId], references: [id])

  @@unique([messageId, userId])
  // Optimized Indexes for Performance
  @@index([userId]) // Existing - User read tracking
  @@index([readAt]) // Existing - Read time tracking
  @@index([messageId]) // Message read tracking
  @@index([userId, readAt]) // Compound: User read history
}

model MessageReaction {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())

  // Relations
  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation("UserMessageReactions", fields: [userId], references: [id])

  @@unique([messageId, userId, emoji])
  // Optimized Indexes for Performance
  @@index([messageId]) // Existing - Message reactions
  @@index([userId]) // Existing - User reactions
  @@index([emoji]) // Emoji filtering
  @@index([createdAt]) // Time-based sorting
}

model Notification {
  id          String           @id @default(uuid())
  userId      String
  title       String
  message     String
  type        NotificationType @default(INFO)
  read        Boolean          @default(false)
  readAt      DateTime?
  relatedType String? // e.g., 'task', 'message', 'invoice', 'document', 'project'
  relatedId   String? // ID of the related entity
  projectId   String?
  actionUrl   String? // URL to navigate when notification is clicked
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  // Relations
  user    User     @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id])

  // Optimized Indexes for Performance
  @@index([userId]) // Existing - User notifications
  @@index([read]) // Existing - Read status filtering
  @@index([type]) // Existing - Notification type
  @@index([relatedType, relatedId]) // Existing - Related entity tracking
  @@index([createdAt]) // Existing - Time-based sorting
  @@index([projectId]) // Project notifications
  @@index([userId, read]) // Compound: Unread notifications
  @@index([userId, createdAt]) // Compound: Recent notifications
  @@index([userId, read, createdAt]) // Compound: Recent unread notifications
  @@index([type, createdAt]) // Compound: Type-based timeline
}

model Document {
  id            String   @id @default(uuid())
  projectId     String?
  userId        String
  filename      String
  originalName  String
  filePath      String
  fileSize      Int
  mimeType      String
  version       Int      @default(1)
  description   String?
  category      String? // e.g., 'CONTRACT', 'PROPOSAL', 'DELIVERABLE'
  isPublic      Boolean  @default(false)
  downloadCount Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  project Project? @relation(fields: [projectId], references: [id])
  user    User     @relation(fields: [userId], references: [id])

  // Optimized Indexes for Performance
  @@index([projectId]) // Existing - Project documents
  @@index([userId]) // Existing - User documents
  @@index([filename]) // Existing - File lookup
  @@index([mimeType]) // Existing - File type filtering
  @@index([category]) // Existing - Category filtering
  @@index([createdAt]) // Time-based sorting
  @@index([isPublic]) // Public/private filtering
  @@index([projectId, category]) // Compound: Project docs by category
  @@index([userId, createdAt]) // Compound: User upload history
}

model TeamMember {
  id             String    @id @default(uuid())
  userId         String
  projectId      String?
  teamId         String?
  role           TeamRole  @default(MEMBER)
  hourlyRate     Float
  allocatedHours Int?
  capacity       Int? // Percentage of time allocated
  startDate      DateTime?
  endDate        DateTime?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  user    User     @relation(fields: [userId], references: [id])
  project Project? @relation(fields: [projectId], references: [id])
  team    Team?    @relation(fields: [teamId], references: [id])

  @@unique([userId, projectId])
  @@unique([userId, teamId])
  // Optimized Indexes for Performance
  @@index([userId]) // Existing - User memberships
  @@index([projectId]) // Existing - Project team members
  @@index([teamId]) // Existing - Team members
  @@index([role]) // Existing - Role filtering
  @@index([isActive]) // Active member filtering
  @@index([startDate]) // Start date tracking
  @@index([endDate]) // End date tracking
  @@index([projectId, isActive]) // Compound: Active project members
  @@index([userId, isActive]) // Compound: User active memberships
  @@index([teamId, role]) // Compound: Team members by role
}

model Lead {
  id                  String     @id @default(uuid())
  companyName         String
  contactName         String
  email               String
  phone               String?
  website             String?
  source              LeadSource @default(WEBSITE)
  status              LeadStatus @default(NEW)
  value               Float
  notes               String?
  assignedTo          String? // User ID of assigned sales member
  lastContact         DateTime?
  nextFollowUp        DateTime?
  qualificationScore  Int        @default(0) // Lead scoring
  companySize         Int? // Number of employees
  budget              Float?
  timeline            String? // e.g., 'Q4 2025'
  emailCampaignStatus String? // JSON: { sent: true, opened: false }
  convertedToClient   Boolean    @default(false)
  convertedAt         DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  // Relations
  deals      Deal[]
  activities LeadActivity[]

  // Optimized Indexes for Performance
  @@index([email]) // Existing - Email lookup
  @@index([status]) // Existing - Status filtering
  @@index([source]) // Existing - Source tracking
  @@index([assignedTo]) // Existing - Assignment tracking
  @@index([nextFollowUp]) // Existing - Follow-up scheduling
  @@index([qualificationScore]) // Existing - Lead scoring
  @@index([createdAt]) // Time-based sorting
  @@index([convertedToClient]) // Conversion tracking
  @@index([convertedAt]) // Conversion time tracking
  @@index([status, assignedTo]) // Compound: Assigned leads by status
  @@index([status, nextFollowUp]) // Compound: Follow-up scheduling
  @@index([assignedTo, nextFollowUp]) // Compound: User follow-ups
  @@index([qualificationScore, status]) // Compound: Qualified leads
}

model Deal {
  id          String    @id @default(uuid())
  leadId      String
  title       String
  value       Float
  stage       DealStage @default(PROSPECT)
  probability Int       @default(0) // Percentage
  closeDate   DateTime?
  wonAt       DateTime?
  lostAt      DateTime?
  lostReason  String?
  description String?
  assignedTo  String? // User ID of assigned sales member
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  clientId    String? // Conversion: link to Client

  // Relations
  lead   Lead    @relation(fields: [leadId], references: [id])
  client Client? @relation(fields: [clientId], references: [id])

  // Optimized Indexes for Performance
  @@index([leadId]) // Existing - Lead deals
  @@index([stage]) // Existing - Deal stage filtering
  @@index([closeDate]) // Existing - Close date tracking
  @@index([assignedTo]) // Existing - Assignment tracking
  @@index([clientId]) // Existing - Client deals
  @@index([createdAt]) // Time-based sorting
  @@index([wonAt]) // Won date tracking
  @@index([lostAt]) // Lost date tracking
  @@index([probability]) // Probability filtering
  @@index([stage, closeDate]) // Compound: Stage-based pipeline
  @@index([assignedTo, stage]) // Compound: User deals by stage
  @@index([stage, probability]) // Compound: Weighted pipeline
}

// Lead Activity Log for tracking actions (calls, emails, notes)
model LeadActivity {
  id          String    @id @default(uuid())
  leadId      String
  userId      String // Sales team member
  type        String // e.g., 'CALL', 'EMAIL', 'NOTE', 'MEETING'
  subject     String?
  content     String?
  outcome     String?
  scheduledAt DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  lead Lead @relation(fields: [leadId], references: [id])
  user User @relation(fields: [userId], references: [id])

  // Optimized Indexes for Performance
  @@index([leadId]) // Existing - Lead activities
  @@index([userId]) // Existing - User activities
  @@index([type]) // Existing - Activity type filtering
  @@index([scheduledAt]) // Existing - Scheduled activities
  @@index([createdAt]) // Existing - Time-based sorting
  @@index([completedAt]) // Completion tracking
  @@index([leadId, type]) // Compound: Lead activity by type
  @@index([userId, scheduledAt]) // Compound: User scheduled activities
  @@index([type, scheduledAt]) // Compound: Activity scheduling
}

model ContactLog {
  id          String      @id @default(uuid())
  clientId    String
  userId      String
  type        ContactType @default(EMAIL)
  subject     String?
  content     String
  outcome     String?
  nextAction  String?
  scheduledAt DateTime?
  completedAt DateTime?
  createdAt   DateTime    @default(now())

  // Relations
  client Client @relation(fields: [clientId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  // Optimized Indexes for Performance
  @@index([clientId]) // Existing - Client contacts
  @@index([userId]) // Existing - User contacts
  @@index([type]) // Existing - Contact type filtering
  @@index([scheduledAt]) // Existing - Scheduled contacts
  @@index([createdAt]) // Existing - Time-based sorting
  @@index([completedAt]) // Completion tracking
  @@index([clientId, type]) // Compound: Client contacts by type
  @@index([userId, scheduledAt]) // Compound: User scheduled contacts
}

model ResourceProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  skills          String // JSON array of skills
  hourlyRate      Float
  currency        String   @default("USD")
  capacity        Int      @default(40) // Hours per week
  availability    String // JSON object with availability schedule
  timezone        String?
  bio             String?
  resume          String? // URL to resume file
  portfolio       String? // URL to portfolio
  languages       String? // JSON array of languages
  certifications  String? // JSON array of certifications
  yearsExperience Int?
  isAvailable     Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([hourlyRate])
  @@index([isAvailable])
}

// Enums
enum Role {
  SUPER_ADMIN
  ADMIN
  PROJECT_MANAGER
  TEAM_MEMBER
  CLIENT
  USER
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  REVIEW
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  TESTING
  DONE
  CANCELLED
}

enum TimeEntryStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum TeamRole {
  LEAD
  SENIOR
  MEMBER
  OBSERVER
}

enum LeadSource {
  WEBSITE
  REFERRAL
  SOCIAL_MEDIA
  EMAIL_CAMPAIGN
  COLD_CALL
  TRADE_SHOW
  PARTNER
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL
  NEGOTIATION
  WON
  LOST
}

enum DealStage {
  PROSPECT
  QUALIFIED
  PROPOSAL
  NEGOTIATION
  CLOSED_WON
  CLOSED_LOST
}

enum ContactType {
  EMAIL
  PHONE
  MEETING
  VIDEO_CALL
  MESSAGE
  OTHER
}

enum MessageType {
  DIRECT
  BROADCAST
  NOTIFICATION
  SYSTEM
  REPLY
}

enum ChannelType {
  TEAM
  PROJECT
  DIRECT
  GENERAL
  ADMIN
  CLIENT
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  TASK
  MESSAGE
  BILLING
  DOCUMENT
  PROJECT_UPDATE
  SYSTEM
}

enum PaymentMethod {
  STRIPE
  PAYPAL
  BANK_TRANSFER
  CHECK
  WIRE_TRANSFER
  CASH
  CREDIT_CARD
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
  PARTIALLY_PAID
  CHARGEBACK
}

enum PaymentReminderType {
  BEFORE_DUE
  ON_DUE_DATE
  OVERDUE_1ST
  OVERDUE_2ND
  OVERDUE_FINAL
  CUSTOM
}

enum ExpenseCategory {
  TRAVEL
  MEALS
  OFFICE_SUPPLIES
  SOFTWARE
  HARDWARE
  MARKETING
  PROFESSIONAL_SERVICES
  TRAINING
  UTILITIES
  RENT
  INSURANCE
  OTHER
}

enum BillingType {
  HOURLY
  FIXED_FEE
  RETAINER
  SUBSCRIPTION
  MILESTONE_BASED
  MIXED
}

enum BillingCycle {
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  ONE_TIME
}

// NextAuth.js Models
model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([provider])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@index([email])
}

// Content Management Models
// ============================================================================
// ENHANCED CONTENT MANAGEMENT SYSTEM - Enterprise-Grade CMS
// ============================================================================

// Content Pages - Enhanced page management with complete metadata
model CmsPage {
  id        String @id @default(uuid())
  pageKey   String @unique // Unique identifier (e.g., 'home', 'about', 'contact')
  pageTitle String // Display title
  slug      String @unique // URL slug
  pageType  String @default("standard") // standard, landing, blog, custom

  // Template reference
  templateId String?
  template   CmsTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)

  // Metadata for SEO
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  ogImage         String?
  ogTitle         String?
  ogDescription   String?
  structuredData  Json? // JSON-LD structured data

  // Status & Publishing
  status               String    @default("draft") // draft, review, scheduled, published, archived
  publishedAt          DateTime?
  scheduledPublishAt   DateTime?
  scheduledUnpublishAt DateTime?

  // Authoring
  authorId     String?
  lastEditedBy String?

  // Settings
  isPublic      Boolean @default(true)
  requiresAuth  Boolean @default(false)
  allowComments Boolean @default(false)
  layout        String? @default("default")

  // SEO Score
  seoScore Int? @default(0) // 0-100

  // Timestamps
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  // Relations
  sections  CmsPageSection[]
  versions  CmsPageVersion[]
  workflows CmsWorkflow[]
  schedules CmsSchedule[]
  comments  CmsComment[] // Task #22: Comment system
  approvals CmsApproval[] // Task #23: Approval system

  // Indexes
  @@index([pageKey])
  @@index([slug])
  @@index([status])
  @@index([templateId])
  @@index([authorId])
  @@index([publishedAt])
  @@index([status, publishedAt])
  @@index([deletedAt])
  @@index([pageTitle, slug, metaDescription]) // Full-text search optimization
}

// Content Page Sections - Granular section-wise editing for CMS pages
model CmsPageSection {
  id          String  @id @default(uuid())
  pageId      String
  page        CmsPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  sectionKey  String // Unique within page (e.g., 'hero', 'features-1')
  sectionType String // hero, features, testimonials, cta, custom
  title       String?
  subtitle    String?

  // Flexible content as JSONB
  content Json // Flexible JSON structure

  // Layout & Display
  order        Int     @default(0)
  isVisible    Boolean @default(true)
  cssClasses   String?
  customStyles Json?

  // Responsive Settings
  showOnMobile  Boolean @default(true)
  showOnTablet  Boolean @default(true)
  showOnDesktop Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexes
  @@unique([pageId, sectionKey])
  @@index([pageId])
  @@index([sectionType])
  @@index([order])
  @@index([pageId, order])
  @@index([isVisible])
}

// Content Page Versions - Complete version control
model CmsPageVersion {
  id            String  @id @default(uuid())
  pageId        String
  page          CmsPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  versionNumber Int

  // Complete snapshots
  pageSnapshot     Json // Full page data at this version
  sectionsSnapshot Json // All sections data at this version

  // Metadata
  changeDescription String?
  createdBy         String
  createdAt         DateTime @default(now())

  // Version info
  isPublished Boolean   @default(false)
  publishedAt DateTime?
  tags        String[] // Tags for organization

  // Indexes
  @@unique([pageId, versionNumber])
  @@index([pageId])
  @@index([createdBy])
  @@index([createdAt])
  @@index([pageId, versionNumber])
  @@index([isPublished])
}

// CMS Templates - Reusable page templates
model CmsTemplate {
  id          String  @id @default(uuid())
  name        String
  description String?
  category    String  @default("general") // landing, blog, portfolio, custom

  // Template structure
  templateStructure Json // Defines available sections and layout
  defaultContent    Json? // Default content for new pages
  thumbnailUrl      String?

  // Settings
  isActive Boolean @default(true)
  isSystem Boolean @default(false) // System templates can't be deleted
  order    Int     @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  pages CmsPage[]

  // Indexes
  @@index([category])
  @@index([isActive])
  @@index([order])
  @@index([category, isActive])
  @@index([name, description]) // Full-text search optimization
}

// Media Assets for CMS - Professional digital asset management with local VPS storage
model CmsMediaAsset {
  id           String          @id @default(uuid())
  folderId     String?
  folder       CmsMediaFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  filename     String
  originalName String
  filePath     String // Relative path on VPS storage
  fileUrl      String // Public URL served by Nginx
  mimeType     String
  fileSize     BigInt

  // Asset type
  assetType String // image, video, document, audio, other

  // Image-specific metadata
  width         Int?
  height        Int?
  aspectRatio   String?
  dominantColor String?

  // SEO & Accessibility
  altText     String?
  caption     String?
  description String?

  // Organization
  tags       String[] // Array of tags
  categories String[] // Array of categories

  // Processing status
  processingStatus String  @default("completed") // pending, processing, completed, failed
  thumbnailUrl     String?
  optimizedUrl     String?

  // Usage tracking
  usageCount Int       @default(0)
  lastUsedAt DateTime?

  // Upload info
  uploadedBy String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime? // Soft delete

  // Indexes
  @@index([folderId])
  @@index([assetType])
  @@index([uploadedBy])
  @@index([createdAt])
  @@index([tags])
  @@index([deletedAt])
  @@index([folderId, assetType])
  @@index([filename, originalName, altText, caption]) // Full-text search optimization
}

// Media Folders for CMS - Hierarchical organization
model CmsMediaFolder {
  id          String           @id @default(uuid())
  name        String
  parentId    String?
  parent      CmsMediaFolder?  @relation("CmsFolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    CmsMediaFolder[] @relation("CmsFolderHierarchy")
  path        String // Full path (e.g., '/images/portfolio')
  description String?
  color       String? // UI organization
  icon        String? // Icon identifier

  // Metadata
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  assets CmsMediaAsset[]

  // Indexes
  @@unique([parentId, name])
  @@index([parentId])
  @@index([path])
  @@index([createdBy])
}

// Content Workflows - Multi-step approval process
model CmsWorkflow {
  id        String  @id @default(uuid())
  pageId    String
  page      CmsPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  versionId String? // Reference to specific version

  // Workflow status
  status      String @default("pending") // pending, in_review, approved, rejected, changes_requested
  currentStep Int    @default(1)
  totalSteps  Int    @default(1)

  // Participants
  submittedBy     String
  submittedAt     DateTime @default(now())
  reviewers       String[] // Array of user IDs
  currentReviewer String?

  // Review details
  reviewerNotes String?
  reviewedBy    String?
  reviewedAt    DateTime?

  // Completion
  completedAt DateTime?

  // Workflow history
  history Json @default("[]") // Array of status changes

  // Indexes
  @@index([pageId])
  @@index([status])
  @@index([submittedBy])
  @@index([currentReviewer])
  @@index([submittedAt])
  @@index([reviewers])
}

// Content Schedule - Automated publishing
model CmsSchedule {
  id     String  @id @default(uuid())
  pageId String
  page   CmsPage @relation(fields: [pageId], references: [id], onDelete: Cascade)

  // Schedule type
  scheduleType String   @default("publish") // publish, unpublish, update
  scheduledFor DateTime
  timezone     String   @default("UTC")

  // Execution status
  status        String    @default("pending") // pending, executed, failed, cancelled
  executedAt    DateTime?
  failureReason String?

  // Content to apply (for updates)
  contentSnapshot Json?

  // Metadata
  createdBy String
  createdAt DateTime @default(now())

  // Indexes
  @@index([pageId])
  @@index([scheduledFor])
  @@index([status])
  @@index([status, scheduledFor])
  @@index([createdBy])
}

// CMS Activity Log - Comprehensive audit trail
model CmsActivityLog {
  id         String   @id @default(uuid())
  userId     String
  action     String // create_page, edit_section, publish, rollback, etc.
  entityType String // page, section, template, media, workflow
  entityId   String
  changes    Json? // Detailed change data
  metadata   Json? // Additional context
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  // Indexes
  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([entityId])
  @@index([createdAt])
  @@index([userId, createdAt])
  @@index([entityType, entityId])
}

// ============================================================================
// LEGACY CONTENT MANAGEMENT (Keep for backward compatibility)
// ============================================================================

model ContentSection {
  id         String   @id @default(uuid())
  sectionKey String   @unique // e.g., 'hero', 'about', 'services'
  title      String?
  subtitle   String?
  content    String? // JSON string for complex content
  imageUrl   String?
  isActive   Boolean  @default(true)
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Service {
  id          String   @id @default(uuid())
  title       String
  description String
  icon        String?
  imageUrl    String?
  features    String? // JSON array of features
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PortfolioItem {
  id            String   @id @default(uuid())
  title         String
  slug          String?  @unique
  description   String
  category      String
  client        String?
  technologies  String? // JSON array of technologies
  imageUrl      String
  featuredImage String? // For compatibility with frontend
  projectUrl    String?
  liveUrl       String? // For compatibility with frontend
  githubUrl     String?
  featured      Boolean  @default(false)
  published     Boolean  @default(true)
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BlogPost {
  id          String    @id @default(uuid())
  title       String
  slug        String    @unique
  excerpt     String
  content     String
  author      String
  imageUrl    String?
  tags        String? // JSON array of tags
  published   Boolean   @default(false)
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model MediaAsset {
  id           String   @id @default(uuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  alt          String?
  category     String? // e.g., 'portfolio', 'blog', 'content'
  uploadedBy   String?
  isFavorite   Boolean  @default(false) // Whether this media is marked as favorite
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Enhanced Content Management Models for Dynamic Content Types
model ContentType {
  id            String   @id @default(uuid())
  name          String   @unique // e.g., 'hero', 'feature', 'testimonial'
  label         String // Display name
  description   String?
  icon          String?
  fields        String // JSON string of ContentField[] - Enhanced field definitions
  settings      String? // JSON string of content type settings (layout, validation, etc.)
  category      String? // Category for organization (e.g., 'sections', 'components', 'pages')
  template      String? // Optional template identifier for rendering
  isSystem      Boolean  @default(false) // Whether this is a system-defined content type
  isActive      Boolean  @default(true)
  allowMultiple Boolean  @default(true) // Whether multiple instances can be created
  maxInstances  Int? // Maximum number of instances allowed (null = unlimited)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  contentItems    DynamicContentItem[]
  contentSections DynamicContentSection[]

  @@index([category, isActive])
  @@index([isSystem, isActive])
}

model DynamicContentItem {
  id            String    @id @default(uuid())
  contentTypeId String
  slug          String?
  title         String
  data          String // JSON string containing dynamic field data
  status        String    @default("draft") // 'draft' | 'published' | 'archived'
  featured      Boolean   @default(false)
  publishedAt   DateTime?
  order         Int       @default(0)
  categories    String? // JSON array of categories
  tags          String? // JSON array of tags
  author        String?
  metadata      String? // JSON string for SEO metadata
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  contentType ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)

  @@unique([contentTypeId, slug])
  @@index([contentTypeId, status])
  @@index([contentTypeId, featured])
  @@index([status, publishedAt])
}

model DynamicContentSection {
  id             String   @id @default(uuid())
  contentTypeId  String
  sectionKey     String   @unique // e.g., 'homepage-hero', 'about-features'
  title          String?
  subtitle       String?
  description    String?
  imageUrl       String? // URL for section image
  layoutSettings String // JSON string for layout configuration
  contentData    String? // JSON string for dynamic field content
  isActive       Boolean  @default(true)
  order          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  contentType ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)

  @@index([contentTypeId, isActive])
  @@index([sectionKey, isActive])
}

// Page Management Model
model Page {
  id              String   @id @default(uuid())
  slug            String   @unique // URL slug e.g., 'home', 'about', 'services'
  title           String // Display title e.g., 'Home Page', 'About Us'
  description     String? // Optional description for admin/SEO
  path            String // Full path e.g., '/', '/about', '/services'
  isActive        Boolean  @default(true)
  isSystem        Boolean  @default(false) // Whether this is a system page (cannot be deleted)
  order           Int      @default(0)
  metaTitle       String? // SEO meta title
  metaDescription String? // SEO meta description
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([slug, isActive])
  @@index([isActive, order])
}

// Advanced Project Management Models

// Project Templates for different methodologies
model ProjectTemplate {
  id                 String             @id @default(uuid())
  name               String
  description        String?
  methodology        ProjectMethodology
  industry           String?
  estimatedDuration  Int? // in days
  tasksTemplate      Json? // Template for default tasks
  milestonesTemplate Json? // Template for milestones
  riskTemplate       Json? // Common risks for this template
  resourceTemplate   Json? // Resource requirements template
  budgetTemplate     Json? // Budget breakdown template
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  // Relations
  projects Project[] @relation("ProjectFromTemplate")

  @@index([methodology])
  @@index([isActive])
}

// Task Dependencies for Gantt chart functionality
model TaskDependency {
  id              String         @id @default(uuid())
  taskId          String
  dependsOnTaskId String
  dependencyType  DependencyType @default(FINISH_TO_START)
  lagDays         Int            @default(0) // Lag time in days
  createdAt       DateTime       @default(now())

  // Relations
  task          Task @relation("TaskDependencies", fields: [taskId], references: [id], onDelete: Cascade)
  dependsOnTask Task @relation("TaskDependents", fields: [dependsOnTaskId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnTaskId])
  @@index([taskId])
  @@index([dependsOnTaskId])
}

// Project Risk Management
model ProjectRisk {
  id               String       @id @default(uuid())
  projectId        String
  title            String
  description      String?
  category         RiskCategory @default(TECHNICAL)
  impactScore      Int // 1-5 scale (constraints enforced in application layer)
  probabilityScore Int // 1-5 scale (constraints enforced in application layer)
  riskScore        Int // Auto-calculated: impact * probability
  status           RiskStatus   @default(OPEN)
  mitigationPlan   String?
  contingencyPlan  String?
  ownerId          String? // Risk owner
  identifiedBy     String
  identifiedAt     DateTime     @default(now())
  reviewDate       DateTime?
  closedAt         DateTime?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  // Relations
  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  owner      User?   @relation("RiskOwner", fields: [ownerId], references: [id])
  identifier User    @relation("RiskIdentifier", fields: [identifiedBy], references: [id])

  @@index([projectId])
  @@index([status])
  @@index([riskScore])
}

// Project Milestones
model ProjectMilestone {
  id           String          @id @default(uuid())
  projectId    String
  title        String
  description  String?
  targetDate   DateTime
  actualDate   DateTime?
  status       MilestoneStatus @default(PENDING)
  order        Int             @default(0)
  isKey        Boolean         @default(false) // Key milestone for client reporting
  deliverables Json? // Array of deliverable descriptions
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([targetDate])
  @@index([status])
}

// Change Requests
model ChangeRequest {
  id             String              @id @default(uuid())
  projectId      String
  requestedBy    String
  title          String
  description    String
  reason         String
  impact         String? // Impact analysis
  estimatedCost  Float?
  estimatedHours Int?
  estimatedDays  Int?
  priority       Priority            @default(MEDIUM)
  status         ChangeRequestStatus @default(PENDING)
  approvedBy     String?
  approvedAt     DateTime?
  implementedAt  DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  // Relations
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requester User    @relation("ChangeRequester", fields: [requestedBy], references: [id])
  approver  User?   @relation("ChangeApprover", fields: [approvedBy], references: [id])

  @@index([projectId])
  @@index([status])
  @@index([priority])
}

// Resource Allocation for workload management
model ResourceAllocation {
  id                   String    @id @default(uuid())
  projectId            String
  userId               String
  role                 String? // Role in the project
  allocationPercentage Float // Percentage of time allocated (0-100)
  hourlyRate           Float?
  startDate            DateTime
  endDate              DateTime?
  isActive             Boolean   @default(true)
  skills               Json? // Array of required/utilized skills
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user    User    @relation("ResourceAllocations", fields: [userId], references: [id])

  @@unique([projectId, userId, startDate])
  @@index([projectId])
  @@index([userId])
  @@index([startDate, endDate])
}

// Project Communications
model ProjectCommunication {
  id              String            @id @default(uuid())
  projectId       String
  type            CommunicationType @default(UPDATE)
  subject         String
  content         String
  senderId        String
  recipients      Json // Array of user IDs
  isClientVisible Boolean           @default(false)
  attachments     Json? // Array of file references
  scheduledFor    DateTime? // For scheduled communications
  sentAt          DateTime?
  createdAt       DateTime          @default(now())

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  sender  User    @relation("CommunicationSender", fields: [senderId], references: [id])

  @@index([projectId])
  @@index([type])
  @@index([isClientVisible])
  @@index([sentAt])
}

// Project Documents with version control
model ProjectDocument {
  id               String           @id @default(uuid())
  projectId        String
  name             String
  description      String?
  filePath         String
  fileSize         BigInt
  mimeType         String
  version          String           @default("1.0")
  isLatest         Boolean          @default(true)
  category         DocumentCategory @default(GENERAL)
  isClientVisible  Boolean          @default(false)
  uploadedBy       String
  parentDocumentId String? // For version tracking
  metadata         Json? // Additional file metadata
  createdAt        DateTime         @default(now())

  // Relations
  project        Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  uploader       User              @relation("DocumentUploader", fields: [uploadedBy], references: [id])
  parentDocument ProjectDocument?  @relation("DocumentVersions", fields: [parentDocumentId], references: [id])
  versions       ProjectDocument[] @relation("DocumentVersions")

  @@index([projectId])
  @@index([category])
  @@index([isClientVisible])
  @@index([isLatest])
}

// Project Budget Tracking
model ProjectBudgetItem {
  id                 String         @id @default(uuid())
  projectId          String
  category           BudgetCategory
  name               String
  description        String?
  budgetedAmount     Float
  actualAmount       Float          @default(0)
  variance           Float          @default(0) // Calculated field
  isRecurring        Boolean        @default(false)
  recurringFrequency String? // monthly, weekly, etc.
  startDate          DateTime?
  endDate            DateTime?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([category])
}

// Enhanced Enums for Advanced Project Management
enum ProjectMethodology {
  AGILE
  WATERFALL
  HYBRID
  KANBAN
  SCRUM
  LEAN
  PRINCE2
}

enum DependencyType {
  FINISH_TO_START
  START_TO_START
  FINISH_TO_FINISH
  START_TO_FINISH
}

enum RiskCategory {
  TECHNICAL
  BUSINESS
  RESOURCE
  SCHEDULE
  BUDGET
  EXTERNAL
  QUALITY
  COMMUNICATION
}

enum RiskStatus {
  OPEN
  MITIGATED
  CLOSED
  MONITORING
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DELAYED
  CANCELLED
}

enum ChangeRequestStatus {
  PENDING
  APPROVED
  REJECTED
  IMPLEMENTED
  CANCELLED
}

enum CommunicationType {
  UPDATE
  ANNOUNCEMENT
  ALERT
  REMINDER
  REPORT
  MEETING_MINUTES
}

enum DocumentCategory {
  GENERAL
  REQUIREMENTS
  DESIGN
  DEVELOPMENT
  TESTING
  DEPLOYMENT
  CONTRACTS
  REPORTS
  PRESENTATIONS
}

enum BudgetCategory {
  LABOR
  MATERIALS
  EQUIPMENT
  SOFTWARE
  TRAVEL
  TRAINING
  OVERHEAD
  CONTINGENCY
}

// Tools & Integrations Management
model Integration {
  id            String              @id @default(uuid())
  name          String
  type          IntegrationType
  category      IntegrationCategory
  description   String?
  isEnabled     Boolean             @default(false)
  configuration Json? // Encrypted configuration data
  apiKey        String? // Encrypted API key
  webhookUrl    String?
  lastSyncAt    DateTime?
  status        IntegrationStatus   @default(INACTIVE)
  errorMessage  String?
  syncFrequency String? // cron expression
  metadata      Json? // Additional metadata
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  logs IntegrationLog[]

  @@index([type])
  @@index([category])
  @@index([status])
  @@index([isEnabled])
}

model IntegrationLog {
  id            String   @id @default(uuid())
  integrationId String
  action        String // sync, test, enable, disable, configure
  status        String // success, error, warning
  message       String?
  metadata      Json?
  createdAt     DateTime @default(now())

  // Relations
  integration Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([action])
  @@index([status])
  @@index([createdAt])
}

enum IntegrationType {
  SLACK
  GITHUB
  GOOGLE_ANALYTICS
  TRELLO
  ZOOM
  HUBSPOT
  JIRA
  DISCORD
  MICROSOFT_TEAMS
  ASANA
  LINEAR
  NOTION
  FIGMA
  STRIPE
  MAILCHIMP
}

enum IntegrationCategory {
  COMMUNICATION
  DEVELOPMENT
  ANALYTICS
  PROJECT_MANAGEMENT
  CRM
  MEETINGS
  DESIGN
  PAYMENTS
  MARKETING
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
  SYNCING
  PENDING
}

// Meeting and Calendar Models
enum MeetingType {
  IN_PERSON
  VIDEO_CALL
  PHONE_CALL
  CONFERENCE
}

enum MeetingStatus {
  SCHEDULED
  CANCELLED
  COMPLETED
  IN_PROGRESS
  RESCHEDULED
  NO_SHOW
}

enum AttendeeStatus {
  INVITED
  ACCEPTED
  DECLINED
  TENTATIVE
  NO_RESPONSE
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

model Meeting {
  id          String        @id @default(uuid())
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  duration    Int // Duration in minutes
  type        MeetingType   @default(VIDEO_CALL)
  status      MeetingStatus @default(SCHEDULED)
  location    String? // Physical location or meeting link
  timezone    String        @default("UTC")

  // Organizer
  organizerId String
  organizer   User   @relation("MeetingOrganizer", fields: [organizerId], references: [id])

  // Project association (optional)
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id])

  // Client association (optional)
  clientId String?
  client   Client? @relation(fields: [clientId], references: [id])

  // Recurrence settings
  isRecurring       Boolean              @default(false)
  recurrenceRule    String? // RRULE format
  recurrenceFreq    RecurrenceFrequency?
  recurrenceEnd     DateTime?
  parentMeetingId   String? // For recurring meeting instances
  recurringMeetings Meeting[]            @relation("RecurringInstances")
  parentMeeting     Meeting?             @relation("RecurringInstances", fields: [parentMeetingId], references: [id])

  // Meeting content
  agenda       String? // JSON array of agenda items
  notes        String? // Meeting notes/minutes
  recordingUrl String?
  attachments  String? // JSON array of attachment URLs

  // Metadata
  reminderSent Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  attendees   MeetingAttendee[]
  actionItems MeetingActionItem[]

  @@index([organizerId])
  @@index([projectId])
  @@index([clientId])
  @@index([startTime])
  @@index([status])
  @@index([type])
}

model MeetingAttendee {
  id         String         @id @default(uuid())
  meetingId  String
  userId     String?
  clientId   String?
  email      String? // For external attendees
  name       String? // For external attendees
  status     AttendeeStatus @default(INVITED)
  isRequired Boolean        @default(true)
  attended   Boolean        @default(false)
  joinedAt   DateTime?
  leftAt     DateTime?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  // Relations
  meeting Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  user    User?   @relation("MeetingAttendees", fields: [userId], references: [id])
  client  Client? @relation(fields: [clientId], references: [id])

  @@index([meetingId])
  @@index([userId])
  @@index([clientId])
  @@index([status])
}

model MeetingActionItem {
  id          String    @id @default(uuid())
  meetingId   String
  title       String
  description String?
  assigneeId  String?
  dueDate     DateTime?
  completed   Boolean   @default(false)
  completedAt DateTime?
  priority    Priority  @default(MEDIUM)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  meeting  Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  assignee User?   @relation("ActionItemAssignee", fields: [assigneeId], references: [id])

  @@index([meetingId])
  @@index([assigneeId])
  @@index([dueDate])
  @@index([completed])
}

// ============================================================================
// REPORTING SYSTEM MODELS
// ============================================================================

enum ReportType {
  PROJECT_STATUS
  PROJECT_TIMELINE
  TASK_COMPLETION
  RESOURCE_ALLOCATION
  RISK_ASSESSMENT
  REVENUE_BY_PROJECT
  PROFITABILITY_ANALYSIS
  BUDGET_VS_ACTUAL
  INVOICE_STATUS
  PAYMENT_COLLECTION
  TEAM_PRODUCTIVITY
  INDIVIDUAL_PERFORMANCE
  TIME_TRACKING
  WORKLOAD_DISTRIBUTION
  SKILL_UTILIZATION
  CLIENT_SATISFACTION
  PROJECT_DELIVERABLES
  COMMUNICATION_LOGS
  SERVICE_LEVEL
  CUSTOM
}

enum ReportCategory {
  PROJECTS
  FINANCIAL
  TEAM
  CLIENTS
  TIME
  CUSTOM
}

enum ReportFormat {
  PDF
  EXCEL
  CSV
  JSON
}

enum ReportStatus {
  DRAFT
  GENERATING
  COMPLETED
  FAILED
  SCHEDULED
}

enum ReportFrequency {
  ONCE
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

model ReportTemplate {
  id          String         @id @default(uuid())
  name        String
  description String?
  category    ReportCategory
  type        ReportType
  isBuiltIn   Boolean        @default(false) // Pre-built templates vs custom
  isActive    Boolean        @default(true)

  // Template configuration
  config Json // Data sources, filters, chart types, formatting options
  layout Json? // Report layout configuration

  // Metadata
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  reports   Report[]
  schedules ReportSchedule[]

  @@index([category])
  @@index([type])
  @@index([isBuiltIn])
  @@index([isActive])
}

model Report {
  id          String         @id @default(uuid())
  name        String
  description String?
  category    ReportCategory
  type        ReportType
  status      ReportStatus   @default(DRAFT)

  // Report configuration
  templateId String?
  template   ReportTemplate? @relation(fields: [templateId], references: [id])
  config     Json // Filters, date ranges, data sources

  // Generated data
  data     Json? // Report data
  metadata Json? // Statistics, totals, summaries

  // File storage
  pdfUrl   String? // URL to generated PDF
  excelUrl String? // URL to generated Excel file
  csvUrl   String? // URL to generated CSV file
  fileSize Int? // File size in bytes

  // Generation info
  generatedAt    DateTime?
  generatedBy    String?
  generationTime Int? // Time taken in milliseconds

  // Error tracking
  error      String? // Error message if generation failed
  retryCount Int     @default(0)

  // Access control
  isPublic   Boolean  @default(false)
  sharedWith String[] // Array of user IDs

  // Metadata
  viewCount     Int       @default(0)
  downloadCount Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  expiresAt     DateTime? // Auto-delete old reports

  // Relations
  scheduleId String?
  schedule   ReportSchedule? @relation(fields: [scheduleId], references: [id])

  @@index([category])
  @@index([type])
  @@index([status])
  @@index([templateId])
  @@index([scheduleId])
  @@index([generatedAt])
  @@index([expiresAt])
}

model ReportSchedule {
  id          String  @id @default(uuid())
  name        String
  description String?

  // Template and configuration
  templateId String
  template   ReportTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  config     Json // Filters, parameters

  // Schedule settings
  frequency      ReportFrequency
  cronExpression String? // For custom schedules
  timezone       String          @default("UTC")

  // Delivery settings
  format       ReportFormat
  recipients   String[] // Array of email addresses
  emailSubject String?
  emailBody    String?

  // Execution info
  isActive     Boolean   @default(true)
  lastRunAt    DateTime?
  nextRunAt    DateTime?
  lastStatus   String? // Success, Failed
  failureCount Int       @default(0)

  // Metadata
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  reports Report[]

  @@index([templateId])
  @@index([frequency])
  @@index([isActive])
  @@index([nextRunAt])
}

model ReportCache {
  id       String         @id @default(uuid())
  cacheKey String         @unique // Hash of report type + filters
  category ReportCategory
  type     ReportType
  data     Json // Cached report data
  metadata Json? // Cached statistics

  // Cache management
  hitCount   Int      @default(0)
  lastAccess DateTime @default(now())
  createdAt  DateTime @default(now())
  expiresAt  DateTime

  @@index([cacheKey])
  @@index([category])
  @@index([type])
  @@index([expiresAt])
  @@index([lastAccess])
}

// File Upload Security Model (Phase 1)
model File {
  id               String   @id @default(cuid())
  filename         String   @unique // Sanitized filename with timestamp
  originalFilename String // Original user-uploaded filename
  mimeType         String // MIME type from validation
  size             Int // File size in bytes
  category         String   @default("document") // document, image, spreadsheet, presentation
  path             String // Relative path in file system
  url              String // Secure URL with token
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectId        String?
  project          Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userId])
  @@index([projectId])
  @@index([category])
  @@index([createdAt])
}

// Token Management Security (Phase 2)
model TokenBlacklist {
  id        String   @id @default(cuid())
  token     String   @unique // JWT or refresh token that has been revoked
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reason    String   @default("logout") // logout, security_incident, user_revoked, token_theft_detected
  expiresAt DateTime // When the token would have expired naturally
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([expiresAt])
  @@index([token])
}

// ============================================================================
// WORKFLOW AUTOMATION SYSTEM (Task 8)
// ============================================================================

// Main Workflow Definition
model Workflow {
  id          String  @id @default(cuid())
  name        String // Workflow name (e.g., "Invoice Reminder", "Milestone Notification")
  description String? // Detailed description of what the workflow does
  enabled     Boolean @default(true) // Whether workflow is active
  version     Int     @default(1) // Version number for workflow updates

  // Workflow Configuration (JSON structure)
  triggers   Json // Array of trigger configurations { type, config, conditions }
  conditions Json // Condition tree for execution (AND/OR logic)
  actions    Json // Array of actions to execute { type, config, order }

  // Metadata
  category String @default("custom") // custom, template, system
  tags     Json? // Array of tags for organization

  // Execution Settings
  priority       Int     @default(5) // 1-10, higher = more important
  maxRetries     Int     @default(3) // Number of retries on failure
  retryDelay     Int     @default(60) // Seconds between retries
  timeout        Int     @default(300) // Max execution time in seconds
  allowParallel  Boolean @default(true) // Allow parallel executions
  rateLimitCount Int?    @default(100) // Max executions per hour (null = unlimited)

  // Statistics
  executionCount  Int       @default(0) // Total executions
  successCount    Int       @default(0) // Successful executions
  failureCount    Int       @default(0) // Failed executions
  lastExecutionAt DateTime? // Last time workflow ran
  avgExecutionMs  Int?      @default(0) // Average execution time

  // Audit
  createdBy String
  creator   User      @relation("WorkflowCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  // Relations
  executions WorkflowExecution[]
  logs       WorkflowLog[]

  @@index([enabled])
  @@index([category])
  @@index([createdBy])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([enabled, deletedAt]) // Active workflows
  @@index([category, enabled]) // Active workflows by category
  @@index([lastExecutionAt]) // Recently executed
}

// Workflow Execution History
model WorkflowExecution {
  id         String   @id @default(cuid())
  workflowId String
  workflow   Workflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  // Execution Status
  status WorkflowExecutionStatus @default(PENDING)

  // Trigger Information
  triggeredBy   String // USER_ACTION, SCHEDULE, WEBHOOK, EVENT
  triggerSource String? // User ID, cron job name, webhook URL, etc.
  triggerData   Json? // Data that triggered the workflow

  // Context Information
  context Json // Execution context (project, task, invoice, etc.)

  // Execution Details
  startedAt   DateTime  @default(now())
  completedAt DateTime? // When execution finished
  duration    Int? // Execution time in milliseconds

  // Results
  actionsExecuted Int   @default(0) // Number of actions that ran
  actionsSuccess  Int   @default(0) // Number of successful actions
  actionsFailed   Int   @default(0) // Number of failed actions
  results         Json? // Results from each action
  errors          Json? // Error details if failed

  // Retry Information
  retryCount  Int       @default(0)
  retryOf     String? // ID of original execution if this is a retry
  nextRetryAt DateTime? // When next retry is scheduled

  // Metadata
  metadata Json? // Additional execution metadata

  @@index([workflowId])
  @@index([status])
  @@index([startedAt])
  @@index([completedAt])
  @@index([triggeredBy])
  @@index([workflowId, status]) // Workflow executions by status
  @@index([workflowId, startedAt]) // Workflow execution history
  @@index([status, startedAt]) // Recent executions by status
}

// Workflow Audit Log
model WorkflowLog {
  id         String   @id @default(cuid())
  workflowId String
  workflow   Workflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  executionId String? // Optional link to execution

  // Log Information
  level   WorkflowLogLevel // INFO, WARNING, ERROR, DEBUG
  message String // Log message
  data    Json? // Additional structured data

  // Context
  action String? // Which action this log is related to
  step   Int? // Step number in workflow

  // Metadata
  timestamp DateTime @default(now())
  duration  Int? // Duration in ms if applicable

  @@index([workflowId])
  @@index([executionId])
  @@index([level])
  @@index([timestamp])
  @@index([workflowId, timestamp]) // Workflow logs chronologically
  @@index([level, timestamp]) // Errors chronologically
}

// Enums for Workflow System
enum WorkflowExecutionStatus {
  PENDING // Queued for execution
  RUNNING // Currently executing
  SUCCESS // Completed successfully
  FAILED // Execution failed
  TIMEOUT // Execution timed out
  CANCELLED // Manually cancelled
  RETRYING // Retry scheduled
}

enum WorkflowLogLevel {
  DEBUG // Detailed debugging information
  INFO // General information
  WARNING // Warning messages
  ERROR // Error messages
  CRITICAL // Critical failures
}

// ============================================================================
// PERFORMANCE MONITORING & ANALYTICS
// ============================================================================

// Performance Metrics - Track page load times, API response times, etc.
model PerformanceMetric {
  id         String   @id @default(cuid())
  metricType String // PAGE_LOAD, API_RESPONSE, LCP, FID, CLS, FCP, TTI, TBT, ERROR
  page       String? // Page path for page-specific metrics
  endpoint   String? // API endpoint for API metrics
  value      Float // Metric value (milliseconds, ratio, etc.)
  metadata   Json? // Additional metadata (ttfb, fcp, lcp, requests, size, etc.)
  timestamp  DateTime @default(now())
  userAgent  String? // Browser/device information
  ipAddress  String? // Anonymized IP for geographic data

  @@index([metricType])
  @@index([page])
  @@index([endpoint])
  @@index([timestamp])
  @@index([metricType, timestamp])
  @@index([page, timestamp])
}

// API Metrics - Detailed tracking of API endpoint performance
model ApiMetric {
  id           String   @id @default(cuid())
  method       String // GET, POST, PUT, DELETE, etc.
  endpoint     String // API endpoint path
  path         String? // Full path with params
  statusCode   Int // HTTP status code
  responseTime Float // Response time in milliseconds
  requestSize  Int? // Request payload size in bytes
  responseSize Int? // Response payload size in bytes
  userId       String? // User making the request (if authenticated)
  ipAddress    String? // Anonymized IP address
  userAgent    String? // User agent string
  timestamp    DateTime @default(now())

  @@index([endpoint])
  @@index([method])
  @@index([statusCode])
  @@index([timestamp])
  @@index([endpoint, timestamp])
  @@index([method, endpoint])
  @@index([userId, timestamp])
}

// Error Logs - Track application errors
model ErrorLog {
  id         String    @id @default(cuid())
  errorType  String // JavaScript, API_5xx, API_4xx, Database, Timeout, etc.
  message    String
  stack      String?   @db.Text // Stack trace
  severity   String // low, medium, high, critical
  page       String? // Page where error occurred
  endpoint   String? // API endpoint if applicable
  userId     String? // User experiencing the error
  metadata   Json? // Additional context
  resolved   Boolean   @default(false)
  resolvedAt DateTime?
  timestamp  DateTime  @default(now())

  @@index([errorType])
  @@index([severity])
  @@index([resolved])
  @@index([timestamp])
  @@index([errorType, timestamp])
  @@index([severity, timestamp])
}

// Database Query Log - Track slow queries
model DatabaseQueryLog {
  id            String   @id @default(cuid())
  query         String   @db.Text // SQL query
  queryHash     String // Hash of query for grouping
  executionTime Float // Execution time in milliseconds
  rowsReturned  Int? // Number of rows returned
  queryPlan     Json? // Query execution plan
  endpoint      String? // API endpoint that triggered query
  userId        String? // User who triggered query
  timestamp     DateTime @default(now())

  @@index([queryHash])
  @@index([executionTime])
  @@index([timestamp])
  @@index([queryHash, timestamp])
}

// System Health Checks - Track service health
model HealthCheck {
  id           String   @id @default(cuid())
  component    String // WebServer, DatabasePrimary, DatabaseReplica, Redis, BackgroundJobs, EmailService
  status       String // healthy, warning, critical
  responseTime Float // Response time in milliseconds
  uptime       Float? // Uptime percentage
  message      String? // Status message
  metadata     Json? // Additional health data
  timestamp    DateTime @default(now())

  @@index([component])
  @@index([status])
  @@index([timestamp])
  @@index([component, timestamp])
}

// Job Posting - Career opportunities
model JobPosting {
  id               String    @id @default(cuid())
  title            String
  department       String // Engineering, Design, Product, Marketing, etc.
  location         String // Remote, Hybrid, or specific location
  type             String // Full-time, Part-time, Contract
  remote           Boolean   @default(true)
  salary           String? // Salary range
  description      String    @db.Text
  requirements     Json // Array of strings
  responsibilities Json // Array of strings
  postedDate       DateTime  @default(now())
  closingDate      DateTime? // Application deadline
  isActive         Boolean   @default(true)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([department])
  @@index([type])
  @@index([isActive])
  @@index([postedDate])
  @@index([isActive, postedDate])
}

// Downloadable Resource - Templates, guides, and resources for users
model DownloadableResource {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  category    String // Branding, Development, Design, Documentation, Tools, Education
  fileType    String // ZIP, PDF, FIG, MP4, etc.
  fileName    String // Original file name
  filePath    String // Storage path or URL
  fileSize    Int // File size in bytes
  downloads   Int      @default(0)
  rating      Float?   @default(0)
  ratingCount Int      @default(0)
  featured    Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Indexes for performance
  @@index([category])
  @@index([fileType])
  @@index([featured])
  @@index([isActive])
  @@index([downloads])
  @@index([rating])
  @@index([updatedAt])
  @@index([isActive, featured])
  @@index([category, isActive])
}

// ============================================
// CONTENT MIGRATION MODELS (Static to Dynamic)
// ============================================
// These models are SEPARATE from the existing CmsPage system.
// Purpose: Migrate static React component content into database
// so CMS admin can display and manage it.

// Page Content - Simple page structure for static content migration
model PageContent {
  id          String              @id @default(cuid())
  pageKey     String              @unique // e.g., 'home', 'about', 'services', 'contact'
  name        String // Display name
  slug        String // URL slug
  title       String // Page title for SEO
  description String?             @db.Text // Meta description
  status      String              @default("published") // draft, published
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  sections    PageContentSection[]

  @@index([pageKey])
  @@index([status])
  @@index([slug])
}

// Page Content Section - Individual sections within a page
model PageContentSection {
  id          String      @id @default(cuid())
  pageId      String
  page        PageContent @relation(fields: [pageId], references: [id], onDelete: Cascade)
  sectionKey  String // e.g., 'hero', 'about', 'services', 'testimonials'
  sectionType String // hero, text, features, cards, testimonials, cta
  title       String? // Section title (optional)
  contentData Json // All section-specific data (flexible JSON structure)
  order       Int // Display order on page
  isVisible   Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([pageId])
  @@index([sectionKey])
  @@index([order])
  @@index([isVisible])
  @@index([pageId, order])
}

// Page Media Asset - Simple media management for page content
model PageMediaAsset {
  id           String   @id @default(cuid())
  fileName     String // Display name
  originalName String // Original file name
  fileUrl      String // Public URL path
  filePath     String // Server file path
  fileType     String // image, video, document
  mimeType     String // image/png, video/mp4, etc.
  fileSize     Int // Size in bytes
  width        Int? // For images
  height       Int? // For images
  altText      String? // Accessibility text
  caption      String? // Image caption
  uploadedBy   String // User ID who uploaded
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([fileType])
  @@index([uploadedBy])
  @@index([createdAt])
  @@index([fileName])
}

// System Settings - Global application settings
model SystemSettings {
  id                     String   @id @default(cuid())
  // General
  siteName               String   @default("Zyphex-Tech")
  tagline                String?
  email                  String?
  phone                  String?
  address                String?
  logo                   String?
  favicon                String?
  facebook               String?
  twitter                String?
  instagram              String?
  linkedin               String?
  youtube                String?
  // Security
  minPasswordLength      Int      @default(8)
  requireUppercase       Boolean  @default(true)
  requireNumbers         Boolean  @default(true)
  requireSpecialChars    Boolean  @default(true)
  twoFactorEnabled       Boolean  @default(false)
  sessionTimeout         Int      @default(30)
  maxLoginAttempts       Int      @default(5)
  ipWhitelist            Json?
  // Email
  smtpHost               String?
  smtpPort               Int      @default(587)
  smtpUser               String?
  smtpPassword           String?
  smtpEncryption         String?  @default("TLS")
  fromName               String?
  fromEmail              String?
  notifyOnNewUser        Boolean  @default(true)
  notifyOnNewProject     Boolean  @default(true)
  notifyOnTaskComplete   Boolean  @default(false)
  // System
  timezone               String   @default("America/Los_Angeles")
  dateFormat             String   @default("MM/DD/YYYY")
  timeFormat             String   @default("12h")
  language               String   @default("en-US")
  maintenanceMode        Boolean  @default(false)
  maintenanceMessage     String?
  debugMode              Boolean  @default(false)
  cacheEnabled           Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

// ============================================================================
// CMS AUTOMATION SYSTEM (Tasks #21 & #22)
// ============================================================================

// Automation Rules - Event-driven workflow automation for CMS
model CmsAutomationRule {
  id          String   @id @default(cuid())
  name        String // Rule name (e.g., "Auto-publish approved pages")
  description String? // Description of what the rule does
  isActive    Boolean  @default(true) // Whether rule is active

  // Automation Configuration (JSON structures)
  trigger     Json // AutomationTrigger type { type, config }
  conditions  Json // AutomationCondition[] type - array of conditions
  actions     Json // AutomationAction[] type - array of actions to execute

  // Metadata
  createdBy String // User ID who created the rule
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  executions CmsAutomationExecution[]

  // Indexes
  @@index([isActive])
  @@index([createdBy])
  @@index([createdAt])
  @@index([isActive, createdAt])
  @@map("cms_automation_rules")
}

// Automation Execution History - Track automation rule executions
model CmsAutomationExecution {
  id          String   @id @default(cuid())
  ruleId      String // Reference to automation rule
  triggeredBy String // TriggerType (e.g., 'page_created', 'status_changed')
  triggeredAt DateTime @default(now())

  // Execution Status
  status String @default("pending") // pending, running, completed, failed, cancelled

  // Execution Context
  context Json // ExecutionContext type { pageId, sectionId, userId, triggerData, metadata }
  actions Json // ActionExecution[] type - results from each action

  // Completion Info
  completedAt DateTime? // When execution finished
  error       String?   @db.Text // Error message if failed

  // Relations
  rule CmsAutomationRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([ruleId])
  @@index([status])
  @@index([triggeredAt])
  @@index([ruleId, status])
  @@index([ruleId, triggeredAt])
  @@index([status, triggeredAt])
  @@map("cms_automation_executions")
}

// CMS Comments - Internal team collaboration on CMS pages
model CmsComment {
  id          String   @id @default(cuid())
  pageId      String // Reference to CMS page
  sectionId   String? // Optional: specific section being commented on
  content     String   @db.Text // Comment text
  authorId    String // User ID of comment author
  authorName  String // Author name (denormalized for performance)
  authorEmail String // Author email

  // Threading
  parentId String? // For nested replies
  parent   CmsComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies  CmsComment[] @relation("CommentReplies")

  // Resolution Tracking
  isResolved Boolean   @default(false)
  resolvedBy String? // User ID who resolved
  resolvedAt DateTime? // When resolved

  // Mentions
  mentions Json @default("[]") // Array of user IDs mentioned (@username)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  page   CmsPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  author User    @relation(fields: [authorId], references: [id])

  // Indexes
  @@index([pageId])
  @@index([sectionId])
  @@index([authorId])
  @@index([parentId])
  @@index([isResolved])
  @@index([createdAt])
  @@index([pageId, isResolved])
  @@index([pageId, createdAt])
  @@index([authorId, createdAt])
  @@map("cms_comments")
}

// CMS Approval System - Multi-step content approval workflow
model CmsApproval {
  id                String   @id @default(cuid())
  pageId            String // Reference to CMS page
  requestedBy       String // User ID who requested approval
  requestedByName   String
  requestedByEmail  String
  status            String   @default("pending") // pending, in_progress, approved, rejected, cancelled
  currentStep       Int      @default(1)
  totalSteps        Int
  steps             Json // ApprovalStep[] - array of approval steps
  comments          String?  @db.Text
  metadata          Json     @default("{}")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  completedAt       DateTime?

  // Relations
  page    CmsPage               @relation(fields: [pageId], references: [id], onDelete: Cascade)
  history CmsApprovalHistory[]

  // Indexes
  @@index([pageId])
  @@index([requestedBy])
  @@index([status])
  @@index([createdAt])
  @@index([pageId, status])
  @@index([status, createdAt])
  @@map("cms_approvals")
}

// CMS Approval History - Audit trail for approval actions
model CmsApprovalHistory {
  id               String   @id @default(cuid())
  approvalId       String
  action           String // created, approved, rejected, delegated, cancelled
  stepNumber       Int?
  performedBy      String // User ID
  performedByName  String
  performedByEmail String
  comments         String?  @db.Text
  metadata         Json     @default("{}")
  timestamp        DateTime @default(now())

  // Relations
  approval CmsApproval @relation(fields: [approvalId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([approvalId])
  @@index([action])
  @@index([performedBy])
  @@index([timestamp])
  @@index([approvalId, timestamp])
  @@map("cms_approval_history")
}

// CMS Backup - Backup management for disaster recovery
model CmsBackup {
  id          String    @id @default(cuid())
  name        String
  type        String // full, incremental, manual
  status      String    @default("pending") // pending, in_progress, completed, failed, expired
  size        BigInt    @default(0) // File size in bytes
  filePath    String // Path to backup file
  compressed  Boolean   @default(false)
  createdBy   String // User ID
  createdAt   DateTime  @default(now())
  completedAt DateTime?
  expiresAt   DateTime?
  metadata    Json      @default("{}") // BackupMetadata
  error       String?   @db.Text

  // Relations
  restoreHistory CmsRestoreHistory[]

  // Indexes
  @@index([type])
  @@index([status])
  @@index([createdBy])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([status, createdAt])
  @@map("cms_backups")
}

// CMS Restore History - Track restore operations
model CmsRestoreHistory {
  id         String   @id @default(cuid())
  backupId   String
  restoredBy String // User ID
  restoredAt DateTime @default(now())
  success    Boolean  @default(true)
  error      String?  @db.Text
  metadata   Json     @default("{}")

  // Relations
  backup CmsBackup @relation(fields: [backupId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([backupId])
  @@index([restoredBy])
  @@index([restoredAt])
  @@map("cms_restore_history")
}

// ============================================================================
// Task #25: Performance Monitoring Models
// ============================================================================

model CmsPerformanceMetric {
  id          String   @id @default(cuid())
  metricType  String // api_response_time, page_load_time, database_query_time, cache_hit_rate, memory_usage, cpu_usage, error_rate, throughput, custom
  metricName  String
  value       Float
  unit        String // ms, %, MB, requests/sec, etc.
  context     Json     @default("{}")
  recordedBy  String // User ID or 'system'
  recordedAt  DateTime @default(now())
  tags        String[] @default([])

  // Indexes
  @@index([metricType])
  @@index([metricName])
  @@index([recordedAt])
  @@index([recordedBy])
  @@index([metricType, recordedAt])
  @@map("cms_performance_metrics")
}

model CmsPerformanceAlert {
  id              String    @id @default(cuid())
  alertType       String // threshold_exceeded, anomaly_detected, degradation, outage
  severity        String // low, medium, high, critical
  message         String    @db.Text
  metricType      String
  threshold       Float
  currentValue    Float
  triggeredAt     DateTime  @default(now())
  resolvedAt      DateTime?
  acknowledged    Boolean   @default(false)
  acknowledgedBy  String? // User ID
  context         Json      @default("{}")

  // Indexes
  @@index([alertType])
  @@index([severity])
  @@index([metricType])
  @@index([triggeredAt])
  @@index([resolvedAt])
  @@index([acknowledged])
  @@map("cms_performance_alerts")
}

// ============================================================================
// Task #26: Error Handling Models
// ============================================================================

model CmsErrorLog {
  id              String    @id @default(cuid())
  errorType       String // validation_error, authentication_error, authorization_error, not_found_error, database_error, network_error, timeout_error, rate_limit_error, internal_server_error, external_api_error, business_logic_error, unknown_error
  severity        String // low, medium, high, critical
  message         String    @db.Text
  stackTrace      String?   @db.Text
  context         Json      @default("{}")
  userId          String? // User who encountered the error
  endpoint        String? // API endpoint or route
  method          String? // HTTP method (GET, POST, etc.)
  statusCode      Int?
  userAgent       String?   @db.Text
  ipAddress       String?
  resolved        Boolean   @default(false)
  resolvedAt      DateTime?
  resolvedBy      String? // User ID
  occurrences     Int       @default(1)
  firstOccurrence DateTime  @default(now())
  lastOccurrence  DateTime  @default(now())
  tags            String[]  @default([])

  // Indexes
  @@index([errorType])
  @@index([severity])
  @@index([resolved])
  @@index([userId])
  @@index([endpoint])
  @@index([lastOccurrence])
  @@index([errorType, lastOccurrence])
  @@index([severity, resolved])
  @@map("cms_error_logs")
}

// Task #27: API Documentation Models
model CmsApiDocumentation {
  id          String   @id @default(cuid())
  endpoint    String   // API endpoint path (e.g., /api/cms/pages)
  method      String   // HTTP method (GET, POST, PUT, DELETE, PATCH)
  category    String   // Category (Pages, Media, Workflows, etc.)
  title       String   // Short description
  description String   @db.Text // Detailed description
  
  // Request documentation
  requestSchema    Json? // JSON schema for request body
  requestExample   Json? // Example request body
  queryParameters  Json? // Query parameter definitions
  pathParameters   Json? // Path parameter definitions
  headers          Json? // Required/optional headers
  
  // Response documentation
  responseSchema   Json? // JSON schema for response
  responseExample  Json? // Example response
  errorResponses   Json? // Possible error responses
  
  // Metadata
  version          String   @default("1.0.0")
  deprecated       Boolean  @default(false)
  requiresAuth     Boolean  @default(true)
  requiredRoles    String[] // Required user roles
  rateLimits       Json?    // Rate limiting info
  tags             String[] // Categorization tags
  
  // Tracking
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  createdBy        String?
  updatedBy        String?
  
  @@index([endpoint])
  @@index([method])
  @@index([category])
  @@index([deprecated])
  @@index([endpoint, method])
  @@map("cms_api_documentation")
}

// Contact Form Submissions
model ContactSubmission {
  id          String   @id @default(uuid())
  firstName   String   @map("first_name")
  lastName    String   @map("last_name")
  email       String
  phone       String?
  company     String?
  service     String
  budget      String?
  message     String   @db.Text
  newsletter  Boolean  @default(false)
  status      String   @default("new") // new, contacted, closed
  notes       String?  @db.Text // Admin notes
  ipAddress   String?  @map("ip_address") // Track IP for spam prevention
  userAgent   String?  @map("user_agent") // Track user agent
  emailSent   Boolean  @default(false) @map("email_sent") // Track if email was sent successfully
  emailError  String?  @map("email_error") // Store email error if failed
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([emailSent])
  @@map("contact_submissions")
}

